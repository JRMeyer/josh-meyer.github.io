

########################
### INSTALL SOFTWARE ###
########################

# Install dependencies #

sudo apt-get update
# DeepSpeech Dependencies
sudo apt-get install git gcc unzip sox libsox-fmt-mp3
sudo apt-get install python3-dev virtualenv
# kenlm Dependencies
sudo apt-get install build-essential cmake libboost-all-dev zlib1g-dev libbz2-dev liblzma-dev libeigen3-dev

# Install DeepSpeech #

git clone https://github.com/mozilla/DeepSpeech
cd DeepSpeech
bash .install
cd ..

# Install CorporaCreator #

source ../tmp/venv/bin/activate
git clone https://github.com/mozilla/CorporaCreator
cd CorporaCreator
python3 setup.py install
cd ..

# Install Kenlm #

wget -O - https://kheafield.com/code/kenlm.tar.gz | tar xz
mkdir kenlm/build
cd kenlm/build
cmake ..
make -j `nproc`
cd ../..


################
### GET DATA ###
################

wget clips.tsv.zip
unzip clips.tsv.zip
wget LANG.zip
unzip LANG.zip -d LANG


###################
### FORMAT DATA ###
###################

# Make {train,dev,test}.csv #

create-corpora -f clips.tsv -d corpora -l LANG -s 10
python3 DeespSpeech/bin/import_cv2.py LANG corpora/LANG

# Make alphabet.txt #

python3 DeepSpeech/util/check_characters.py -csv LANG/train.csv,LANG/test.csv,LANG/dev.csv -alpha
# now, copy-paste output from above command into alphabet.txt
emacs alphabet.txt

# Make lm.binary and trie #

cut -d',' -f3 train.csv > text.txt

kenlm/build/bin/lmplz \
           --order 2 \
           --text text.txt \
           --arpa lm.arpa \
           --discount_fallback

kenlm/build/bin/build_binary \
           -a 255 \
           -q 8 \
           trie \
           lm.arpa \
           lm.binary

tmp/native_client/generate_trie \
           alphabet.txt \
           lm.binary \
           trie

cp trie DeepSpeech/data/lm/trie
cp lm.binary DeepSpeech/data/lm/lm.binary
cp alphabet.txt DeepSpeech/data/alphabet.txt



################
### TRAINING ###
################

cd DeepSpeech
# add paths to LANG/{train,dev,test}.csv in .compute
emacs .compute 
bash .compute
